import{ad as j,g as w,a as x,D as R,u as k,af as z,b as a,c as _,d as M,s as $,e as A,ae as L,R as C,bk as K,i as V,t as B,l as G,a8 as X,as as Z,at as ee,o as f,Q as te,q as oe,k as ae,aD as se,aW as ne,aR as re,bl as le,bm as ie,a1 as ce,bn as de,T as S,n as pe,C as ge,ap as ue,an as be,r as he}from"./index-BraCgBdp.js";const Q=j();function ye(e){return w("MuiTable",e)}x("MuiTable",["root","stickyHeader"]);const me=e=>{const{classes:t,stickyHeader:o}=e;return M({root:["root",o&&"stickyHeader"]},ye,t)},ve=$("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.stickyHeader&&t.stickyHeader]}})(A(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),U="table",q=R(function(t,o){const s=k({props:t,name:"MuiTable"}),{className:l,component:n=U,padding:i="normal",size:c="medium",stickyHeader:d=!1,...u}=s,p={...s,component:n,padding:i,size:c,stickyHeader:d},y=me(p),T=z(()=>({padding:i,size:c,stickyHeader:d}),[i,c,d]);return a(Q.Provider,{value:T,children:a(ve,{as:n,role:n===U?null:"table",ref:o,className:_(y.root,l),ownerState:p,...u})})}),D=j();function fe(e){return w("MuiTableBody",e)}x("MuiTableBody",["root"]);const Ce=e=>{const{classes:t}=e;return M({root:["root"]},fe,t)},Te=$("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),we={variant:"body"},E="tbody",F=R(function(t,o){const s=k({props:t,name:"MuiTableBody"}),{className:l,component:n=E,...i}=s,c={...s,component:n},d=Ce(c);return a(D.Provider,{value:we,children:a(Te,{className:_(d.root,l),as:n,ref:o,role:n===E?null:"rowgroup",ownerState:c,...i})})});function xe(e){return w("MuiTableCell",e)}const Re=x("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),ke=e=>{const{classes:t,variant:o,align:s,padding:l,size:n,stickyHeader:i}=e,c={root:["root",o,i&&"stickyHeader",s!=="inherit"&&`align${C(s)}`,l!=="normal"&&`padding${C(l)}`,`size${C(n)}`]};return M(c,xe,t)},_e=$("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.variant],t[`size${C(o.size)}`],o.padding!=="normal"&&t[`padding${C(o.padding)}`],o.align!=="inherit"&&t[`align${C(o.align)}`],o.stickyHeader&&t.stickyHeader]}})(A(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Re.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),h=R(function(t,o){const s=k({props:t,name:"MuiTableCell"}),{align:l="inherit",className:n,component:i,padding:c,scope:d,size:u,sortDirection:p,variant:y,...T}=s,r=L(Q),g=L(D),m=g&&g.variant==="head";let b;i?b=i:b=m?"th":"td";let v=d;b==="td"?v=void 0:!v&&m&&(v="col");const N=y||g&&g.variant,P={...s,align:l,component:b,padding:c||(r&&r.padding?r.padding:"normal"),size:u||(r&&r.size?r.size:"medium"),sortDirection:p,stickyHeader:N==="head"&&r&&r.stickyHeader,variant:N},J=ke(P);let O=null;return p&&(O=p==="asc"?"ascending":"descending"),a(_e,{as:b,ref:o,className:_(J.root,n),"aria-sort":O,scope:v,ownerState:P,...T})});function Me(e){return w("MuiTableHead",e)}x("MuiTableHead",["root"]);const $e=e=>{const{classes:t}=e;return M({root:["root"]},Me,t)},He=$("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Le={variant:"head"},I="thead",De=R(function(t,o){const s=k({props:t,name:"MuiTableHead"}),{className:l,component:n=I,...i}=s,c={...s,component:n},d=$e(c);return a(D.Provider,{value:Le,children:a(He,{as:n,className:_(d.root,l),ref:o,role:n===I?null:"rowgroup",ownerState:c,...i})})});function Se(e){return w("MuiTableRow",e)}const Y=x("MuiTableRow",["root","selected","hover","head","footer"]),ze=e=>{const{classes:t,selected:o,hover:s,head:l,footer:n}=e;return M({root:["root",o&&"selected",s&&"hover",l&&"head",n&&"footer"]},Se,t)},Be=$("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.head&&t.head,o.footer&&t.footer]}})(A(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Y.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${Y.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),W="tr",H=R(function(t,o){const s=k({props:t,name:"MuiTableRow"}),{className:l,component:n=W,hover:i=!1,selected:c=!1,...d}=s,u=L(D),p={...s,component:n,hover:i,selected:c,head:u&&u.variant==="head",footer:u&&u.variant==="footer"},y=ze(p);return a(Be,{as:n,ref:o,className:_(y.root,l),role:n===W?null:"row",ownerState:p,...d})}),Ae=()=>{const e=L(K);if(e===void 0)throw new Error("useLogCount must be used within a DeviceProvider");return{logCount:e.logCount}};function Ne(e,t){const o=new Date(e),s=new Date,l=new Date;return l.setFullYear(s.getFullYear()-1),o<l?o.toLocaleDateString(t,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):o.toLocaleDateString(t,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}function Pe(e,t){return{code_index:t("code_index"),code_value:t("code_value"),code:t("code_value"),method:t("method"),result:t("result"),reason:t("reason"),error_code:t("error_code"),weight:t("weight"),battery_level:t("battery_level"),tagId:t("tag_id"),initiatedBy:t("initiated_by"),bootReason:t("boot_reason"),payload:t("payload")}[e]||e}const Oe=({log:e})=>{const{t,i18n:o}=V("logs"),[s,l]=B(G(!1),"isExpanded"),n=()=>{l(!s)};return a(te,{children:[a(H,{children:[a(h,{title:e.fullDate,children:Ne(e.timestamp,o.language)}),a(h,{children:e.event}),a(h,{children:(()=>{const i={...e.details};return delete i.age,delete i.timestamp,Object.keys(i).length>0?a(X,{"aria-label":"expand row",size:"small",onClick:n,children:a(Z,{style:{transform:s?"rotate(180deg)":"rotate(0deg)"}})}):null})()})]}),a(H,{children:a(h,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:a(ee,{in:s,timeout:"auto",unmountOnExit:!0,children:a(f,{sx:{margin:1},children:a(q,{size:"small","aria-label":"details",children:a(F,{children:(()=>{const i={...e.details};return delete i.age,delete i.timestamp,Object.entries(i).map(([c,d])=>a(H,{children:[a(h,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:Pe(c,t)}),a(h,{children:typeof d=="object"?JSON.stringify(d):String(d)})]},c))})()})})})})})})]})},Ue=({showNotification:e,hideNotification:t})=>{const{t:o,i18n:s}=V(["logs","common"]),{activeDevice:l}=oe(),{isConnected:n}=ae(),{isSyncingLogs:i,requestLogs:c}=se(),{logCount:d}=Ae(),u=ne(()=>l?.id?(console.log(`[LogViewer] Querying logs for device_id: ${l.id}`),re.logs.where("device_id").equals(l.id).toArray().then(r=>r.sort((g,m)=>Number(m.timestamp)-Number(g.timestamp)))):[],[l?.id]),p=B(z(()=>{const r=u??le;return console.log(`[LogViewer] raw logs count: ${r.length}`,r),r},[u]),"logs"),y=B(z(()=>{if(p.length===0)return[];try{console.log(`[LogViewer] Starting parseLogs with ${p.length} logs`);const r=ie(p).map(g=>{const b=new Date(g.timestamp).toLocaleString(s.language);return{...g,fullDate:b,event:o(g.description)}});return console.log(`[LogViewer] Parsing finished. parsedLogs: ${r.length}`,r),r}catch(r){const g=r instanceof Error?r.message:String(r);return console.error(o("parse_error"),g),[]}},[p,s.language,o]),"parsedLogs"),T=ce(async()=>{if(!n){e&&e(o("not_connected"),"error");return}await de(c,{showNotification:e,hideNotification:t,loadingMsg:o("refresh_started"),successMsg:o("refresh_success"),errorMsg:o("refresh_failed")})},[n,c,e,t,o]);return a(f,{sx:{p:2,mb:2,width:"100%"},children:[a(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a(S,{variant:"h5",component:"h2",children:[o("title")," ",d!==null&&d>0&&`(${d})`]}),a(pe,{variant:"outlined",startIcon:i?a(ge,{size:20}):a(ue,{}),onClick:T,disabled:!n||i,children:o("refresh")})]}),!n&&!l&&p.length===0&&a(be,{severity:"info",sx:{mb:2},children:o("connect_to_view")}),a(f,{sx:{height:"100%",width:"100%",overflowY:"auto",borderRadius:1,p:2,backgroundColor:"background.paper",fontFamily:"Courier New, monospace"},children:y.length>0?a(q,{children:[a(De,{children:a(H,{children:[a(h,{children:o("timestamp")}),a(h,{children:o("event_label")}),a(h,{})]})}),a(F,{children:y.map((r,g)=>a(Oe,{log:r},g))})]}):p.length>0?a(f,{children:p.map((r,g)=>{const m=new Date(r.timestamp),b=m.toLocaleDateString(s.language,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),v=m.toLocaleString(s.language);return a(f,{sx:{py:1,borderBottom:"1px solid",borderColor:"divider"},children:[a(S,{component:"span",fontWeight:"bold",title:v,children:b}),": ",r.event]},g)})}):a(S,{align:"center",sx:{fontStyle:"italic",py:2},component:"p",children:o(n||l?"no_logs_when_connected":"no_logs_when_disconnected")})})]})},Ie=()=>{const e=he();if(!e)return null;const{showNotification:t,hideNotification:o}=e;return a(Ue,{showNotification:t,hideNotification:o})};export{Ie as LogViewerWrapper};
