// BLE Constants
export const SERVICE_UUID = 'a7630001-f491-4f21-95ea-846ba586e361';
export const WRITE_CHAR_UUID = 'a7630002-f491-4f21-95ea-846ba586e361';
export const NOTIFY_CHAR_UUID = 'a7630003-f491-4f21-95ea-846ba586e361';
export const CUSTOM_BATTERY_CHAR_UUID = '00000004-0000-1000-8000-00805f9b34fb';

export const BATTERY_SERVICE_UUID = '0000180f-0000-1000-8000-00805f9b34fb';
export const BATTERY_LEVEL_CHAR_UUID = '00002a19-0000-1000-8000-00805f9b34fb';

export const DEVICE_INFO_SERVICE_UUID = '0000180a-0000-1000-8000-00805f9b34fb';
export const DEVICE_INFO_CHARS = {
  'System ID': '00002a23-0000-1000-8000-00805f9b34fb',
  'Model Number': '00002a24-0000-1000-8000-00805f9b34fb',
  'Serial Number': '00002a25-0000-1000-8000-00805f9b34fb',
  'Firmware Revision': '00002a26-0000-1000-8000-00805f9b34fb',
  'Hardware Revision': '00002a27-0000-1000-8000-00805f9b34fb',
  'Software Revision': '00002a28-0000-1000-8000-00805f9b34fb',
  'Manufacturer Name': '00002a29-0000-1000-8000-00805f9b34fb',
} as const;

// Simulator Constants
export const SIMULATOR_BLE_ID = 'SIMULATOR-001';
export const SIMULATOR_DEFAULT_CONFIG_KEY = 'AABBCCDD';
export const SIMULATOR_DEFAULT_PIN = '123456';

// Opcodes Enum
export enum BLEOpcode {
  OPEN_DOOR = 0x01,
  ASK_DOOR_STATUS = 0x02,
  REQUEST_LOGS = 0x03,
  GET_LOGS_COUNT = 0x07,
  TEST_BATTERY = 0x08,
  MASTER_CODE_EDIT = 0x09,
  SINGLE_USE_CODE_TO_MULTI = 0X0A,
  MULTI_CODE_TO_SINGLE_USE = 0X0B,
  DELETE_MASTER_CODE = 0X0C,
  DELETE_SINGLE_USE_CODE = 0X0D,
  DELETE_MULTI_USE_CODE = 0X0E,
  REACTIVATE_CODE = 0X0F,
  CREATE_MASTER_CODE = 0x11,
  CREATE_SINGLE_USE_CODE = 0x12,
  CREATE_MULTI_USE_CODE = 0x13,
  COUNT_CODES = 0x14,
  SET_CONFIGURATION = 0x16,
  REGISTER_NFC_TAG_SCAN_START = 0x17,
  REGISTER_NFC_TAG = 0x18,
  UNREGISTER_NFC_TAG = 0x19,

  // SCALE COMMANDS
  SCALE_BOND = 0x50,
  SCALE_GET_MAC_ADDRESS_BOKS = 0x52,
  SCALE_FORGET_BONDING = 0x53,
  SCALE_TARE_EMPTY = 0x55,
  SCALE_TARE_LOADED = 0x56,
  SCALE_MEASURE_WEIGHT = 0x57,
  SCALE_PREPARE_DFU = 0x60,
  SCALE_GET_RAW_SENSORS = 0x61,
  SCALE_RECONNECT = 0x62,

  // NOTIFICATIONS
  CODE_OPERATION_SUCCESS = 0x77,
  CODE_OPERATION_ERROR = 0x78,
  NOTIFY_LOGS_COUNT = 0x79,

  // ERRORS
  ERROR_COMMAND_NOT_SUPPORTED = 0x80,

  // STATUS
  VALID_OPEN_CODE = 0x81,
  INVALID_OPEN_CODE = 0x82,
  NOTIFY_DOOR_STATUS = 0x84,
  ANSWER_DOOR_STATUS = 0x85,

  // HISTORY / LOGS
  LOG_CODE_BLE_VALID_HISTORY = 0x86,
  LOG_CODE_KEY_VALID_HISTORY = 0x87,
  LOG_CODE_BLE_INVALID_HISTORY = 0x88,
  LOG_CODE_KEY_INVALID_HISTORY = 0x89,
  LOG_DOOR_CLOSE_HISTORY = 0x90,
  LOG_DOOR_OPEN_HISTORY = 0x91,
  LOG_END_HISTORY = 0x92,
  LOG_HISTORY_ERASE = 0x93,

  // POWER / SYSTEM LOGS
  POWER_OFF = 0x94,
  BLOCK_RESET = 0x95,
  POWER_ON = 0x96,
  BLE_REBOOT = 0x97,
  LOG_EVENT_SCALE_MEASURE = 0x98,
  LOG_EVENT_KEY_OPENING = 0x99,
  LOG_EVENT_ERROR = 0XA0, // Renamed from ERROR for consistency with BoksContext
  LOG_EVENT_NFC_OPENING = 0XA1,
  LOG_EVENT_NFC_REGISTERING = 0XA2,

  // SCALE NOTIFICATIONS
  NOTIFY_SCALE_BONDING_SUCCESS = 0XB0,
  NOTIFY_SCALE_BONDING_ERROR = 0XB1,
  NOTIFY_MAC_ADDRESS_BOKS_SCALE = 0XB2,
  NOTIFY_SCALE_BONDING_FORGET_SUCCESS = 0XB3,
  NOTIFY_SCALE_BONDING_PROGRESS = 0XB4,
  NOTIFY_SCALE_TARE_EMPTY_OK = 0XB5,
  NOTIFY_SCALE_TARE_LOADED_OK = 0XB6,
  NOTIFY_SCALE_MEASURE_WEIGHT = 0XB7,
  NOTIFY_SCALE_DISCONNECTED = 0XB8,
  NOTIFY_SCALE_RAW_SENSORS = 0XB9,
  NOTIFY_SCALE_FAULTY = 0XBA,

  // CONFIGURATION & GENERATION NOTIFICATIONS
  NOTIFY_CODES_COUNT = 0XC3,
  NOTIFY_SET_CONFIGURATION_SUCCESS = 0XC4,
  NOTIFY_NFC_TAG_REGISTER_SCAN_RESULT = 0XC5,
  NOTIFY_NFC_TAG_REGISTER_SCAN_ERROR_EXISTS = 0XC6,
  NOTIFY_NFC_TAG_REGISTER_SCAN_TIMEOUT = 0XC7,
  NOTIFY_NFC_TAG_REGISTERED_SUCCESS = 0XC8,
  NOTIFY_NFC_TAG_REGISTERED_ERROR_EXISTS = 0XC9,
  NOTIFY_NFC_TAG_UNREGISTERED_SUCCESS = 0XCA,

  // PROTOCOL ERRORS
  ERROR_CRC = 0XE0,
  ERROR_UNAUTHORIZED = 0XE1,
  ERROR_BAD_REQUEST = 0XE2,

  // INTERNAL / VIRTUAL OPCODES
  INTERNAL_GATT_OPERATION = 0xFE,
}

export const OPCODE_NAMES: Record<number, string> = Object.fromEntries(
  Object.entries(BLEOpcode)
    .filter(([key]) => Number.isNaN(Number(key))) // Filter out numeric keys (reverse mapping)
    .map(([key, value]) => [value as number, key])
);

// Proprietary Battery Service Characteristic
export const BATTERY_PROPRIETARY_CHAR_UUID = '00000004-0000-1000-8000-00805f9b34fb';

// Power off reasons mapping
export const POWER_OFF_REASONS: Record<number, string> = {
  1: 'pin_reset',
  2: 'watchdog',
  3: 'soft_reset',
  4: 'lockup',
  5: 'power_on',
  6: 'wakeup_nfc',
  7: 'wakeup_system_off',
  8: 'wakeup_lpcomp',
};

// Diagnostic error codes mapping
export const DIAGNOSTIC_ERROR_CODES: Record<number, string> = {
  0XBC: 'mfrc630_error_bc',
  0x13: 'mfrc630_error_integrity',
  0x15: 'mfrc630_error_no_tag',
  0X0B: 'mfrc630_error_collision',
  0x03: 'mfrc630_error_buffer',
};

// Constant for stable empty array references
export const EMPTY_ARRAY = Object.freeze([]);

// Timeout constants
export const BLE_DEFAULT_TIMEOUT_MS = 5000;
export const BLE_COMMAND_DELAY_MS = 250;

// UI Delay constants
export const UI_NOTIFICATION_DELAY_MS = 100;
export const UI_MINIMUM_DURATION_MS = 500;

// Debug Wizard constants
export const DEBUG_WIZARD_DISCONNECT_DELAY_MS = 1500;
export const DEBUG_WIZARD_CONNECT_DELAY_MS = 1000;

// BLE Packet constants
export const BLE_PACKET_CHECKSUM_MASK = 255;

// Battery constants
export const BATTERY_INVALID_VALUE = 255;
