
> boks-web-ble@1.0.0 test:e2e /app
> playwright test tests/debug_repro.spec.ts


Running 1 test using 1 worker
PAGE LOG: [vite] connecting...
PAGE LOG: [vite] connected.
PAGE LOG: %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
PAGE LOG: Database initialized with tables: [users, devices, device_secrets, codes, logs, settings, nfc_tags]
PAGE LOG: [Main] React initialized
PAGE LOG: [Main] Rendering app...
PAGE LOG: [Main] Using basename: ""
PAGE LOG: [DB Hook] Creating in users {id: local-user, is_offline: true, updated_at: 1770576034771}
PAGE LOG: Default local user created
PAGE LOG: ‚ö†Ô∏è BoksBLEService: Initializing with SimulatedAdapter ‚ö†Ô∏è
PAGE LOG: [BoksSimulator] Controller exposed to window
PAGE LOG: ‚ö†Ô∏è USING BOKS SIMULATOR ADAPTER ‚ö†Ô∏è
PAGE LOG: StorageService and DB exposed to window.boksDebug
PAGE LOG: [SessionProvider] Initialized
--- PAGE CONTENT START ---
<!DOCTYPE html><html lang="en"><head><meta name="emotion-insertion-point" content="">
    <script type="module">import { injectIntoGlobalHook } from "/@react-refresh";
injectIntoGlobalHook(window);
window.$RefreshReg$ = () => {};
window.$RefreshSig$ = () => (type) => type;</script>

    <script type="module" src="/@vite/client"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boks Web BLE</title>
    <meta name="description" content="Web Bluetooth Controller for Boks Parcel Box">

    <!-- Favicons for various browsers and devices -->
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="icon-48.png">
    <link rel="icon" type="image/png" sizes="128x128" href="icon-128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon.png">

    <!-- Apple Touch Icon (for iOS devices) -->
    <link rel="apple-touch-icon" href="icon.png">

    <meta name="theme-color" content="#1a73e8">
    <link rel="manifest" href="manifest.json">
  <style type="text/css" data-vite-dev-id="/app/src/index.css">/* Custom CSS for Boks Web BLE Application */

/* Import component styles */

/* ConnectionManager.css */

.connection-manager {
  display: flex;
  align-items: center;
}

.connection-status {
  display: flex;
  align-items: center;
  margin-right: 16px;
}

.status-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 8px;
}

.status-indicator.connected {
  background-color: #4caf50;
}

.status-indicator.disconnected {
  background-color: #f44336;
}

.connect-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 14px;
  color: white;
  text-transform: uppercase;
  font-weight: 500;
  transition: background-color 0.3s;
}

.connect-button.connected {
  background-color: #f44336;
}

.connect-button.connected:hover {
  background-color: #d32f2f;
}

.connect-button.disconnected {
  background-color: #1976d2;
}

.connect-button.disconnected:hover {
  background-color: #1565c0;
}

.connect-button:disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.battery-container {
  display: flex;
  align-items: center;
  margin-left: 16px;
  font-size: 14px;
}

.battery-icon {
  width: 20px;
  height: 10px;
  border: 1px solid currentColor;
  position: relative;
  margin-right: 4px;
  background-color: transparent;
}

.battery-level {
  position: absolute;
  top: 1px;
  left: 1px;
  height: 8px;
  background-color: #4caf50;
}

.battery-level.low {
  background-color: #f44336;
}

.battery-terminal {
  content: '';
  position: absolute;
  top: 1px;
  right: -4px;
  width: 3px;
  height: 6px;
  background-color: currentColor;
}

.device-list {
  position: absolute;
  top: 100%;
  left: 0;
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 16px;
  min-width: 250px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 1000;
}

.device-list h3 {
  margin-top: 0;
}

.device-list ul {
  list-style: none;
  padding: 0;
  margin: 8px 0;
}

.device-item {
  margin-bottom: 8px;
}

.device-button {
  width: 100%;
  text-align: left;
  padding: 8px 12px;
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.device-button:hover {
  background-color: #f0f0f0;
}

/* CodeManager.css */

.code-manager {
  background-color: white;
  border-radius: 8px;
  padding: 16px;
}

.code-manager-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.code-manager-title {
  margin: 0;
  color: #333;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

.add-code-form {
  margin-bottom: 16px;
  background-color: #f5f5f5;
  border-radius: 4px;
  padding: 16px;
}

.add-code-form h3 {
  margin-top: 0;
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  margin-bottom: 4px;
  font-weight: 500;
  color: #555;
}

.form-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}

.form-select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}

.form-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 14px;
  background-color: #1976d2;
  color: white;
  text-transform: uppercase;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: background-color 0.3s;
}

.form-button:hover {
  background-color: #1565c0;
}

.saved-codes-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.saved-codes-title {
  margin: 0;
  color: #555;
}

.codes-list {
  /* Styles for the container of code items */
}

.code-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border: 1px solid rgba(0, 0, 0, 0.12);
  border-radius: 4px;
  margin-bottom: 8px;
}

.code-item.used {
  background-color: #f0f0f0;
}

.code-details strong.used {
  text-decoration: line-through;
}

.code-type {
  color: #777;
}

.delete-button {
  padding: 4px 8px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 12px;
  background-color: #f44336;
  color: white;
  text-transform: uppercase;
  font-weight: 500;
  transition: background-color 0.3s;
}

.delete-button:hover {
  background-color: #d32f2f;
}

/* DoorControls.css */

.door-controls {
  background-color: white;
  border-radius: 8px;
  padding: 16px;
  max-width: 400px;
  margin: 0 auto;
  text-align: center;
}

.door-controls-header {
  margin: 0;
  color: #333;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

.open-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 14px;
  color: white;
  text-transform: uppercase;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: background-color 0.3s;
}

.open-button.enabled {
  background-color: #1976d2;
}

.open-button.enabled:hover {
  background-color: #1565c0;
}

.open-button.disabled {
  background-color: #bdbdbd;
  cursor: not-allowed;
}

/* LanguageSelector.css */

.language-selector {
  position: relative;
  display: inline-block;
}

.language-select {
  padding: 8px 12px;
  border-radius: 4px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  background-color: rgba(255, 255, 255, 0.2);
  color: white;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 16px;
  padding-left: 12px;
  padding-right: 32px;
}

.language-option {
  color: #333;
}

/* LogViewer.css */

.log-viewer {
  background-color: var(--mui-background-paper, white);
  border-radius: 8px;
  padding: 16px;
}

@media (prefers-color-scheme: dark) {
  .log-viewer {
    background-color: var(--mui-background-paper, #1e1e1e);
  }
}

.log-viewer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.log-viewer-title {
  margin: 0;
  color: var(--mui-text-primary, #333);
  border-bottom: 1px solid var(--mui-divider, #eee);
  padding-bottom: 8px;
}

@media (prefers-color-scheme: dark) {
  .log-viewer-title {
    color: var(--mui-text-primary, #ecf0f1);
    border-bottom: 1px solid var(--mui-divider, #34495e);
  }
}

.log-controls {
  display: flex;
  gap: 8px;
}

.log-button {
  padding: 6px 12px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: 12px;
  background-color: var(--mui-primary-main, #4a90e2);
  color: white;
  text-transform: uppercase;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: background-color 0.3s;
}

.log-button:hover {
  background-color: var(--mui-primary-dark, #357abd);
}

.log-button.clear {
  background-color: var(--mui-error-main, #e74c3c);
}

.log-button.clear:hover {
  background-color: var(--mui-error-dark, #c0392b);
}

.log-container {
  background-color: var(--mui-background-paper, #2c3e50);
  color: var(--mui-text-primary, #ecf0f1);
  border-radius: 4px;
  padding: 16px;
  font-family: 'Courier New', monospace;
  max-height: 400px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
}

@media (prefers-color-scheme: dark) {
  .log-container {
    background-color: var(--mui-background-paper, #1e1e1e);
    color: var(--mui-text-primary, #ecf0f1);
  }
}

.log-entry {
  margin-bottom: 4px;
  padding: 4px 0;
  border-bottom: 1px solid var(--mui-divider, #34495e);
}

@media (prefers-color-scheme: dark) {
  .log-entry {
    border-bottom: 1px solid var(--mui-divider, #34495e);
  }
}

.log-entry:last-child {
  border-bottom: none;
}

.log-timestamp {
  color: var(--mui-text-secondary, #95a5a6);
  margin-right: 8px;
}

@media (prefers-color-scheme: dark) {
  .log-timestamp {
    color: var(--mui-text-secondary, #bbb);
  }
}

.log-info {
  color: var(--mui-secondary-main, #50e3c2);
}

.log-error {
  color: var(--mui-error-main, #e74c3c);
}

.log-success {
  color: var(--mui-success-main, #2ecc71);
}

.log-warning {
  color: var(--mui-warning-main, #f39c12);
}

.log-debug {
  color: #9b59b6;
}

/* Global Styles */

:root {
  --primary-color: #1a73e8;
  --secondary-color: #50e3c2;
  --danger-color: #e74c3c;
  --warning-color: #f39c12;
  --success-color: #2ecc71;
  --dark-color: #2c3e50;
  --light-color: #ecf0f1;
  --border-radius: 8px;
  --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: #333;
  background-color: #f8f9fa;
}

@media (prefers-color-scheme: dark) {
  body {
    color: #ecf0f1;
    background-color: #121212;
  }
}

/* Container */

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Buttons */

.btn {
  display: inline-block;
  padding: 10px 20px;
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  text-align: center;
  transition: var(--transition);
  text-decoration: none;
}

.btn-primary {
  background-color: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background-color: #357abd;
  transform: translateY(-2px);
}

.btn-secondary {
  background-color: var(--secondary-color);
  color: white;
}

.btn-secondary:hover {
  background-color: #3bd2b0;
  transform: translateY(-2px);
}

.btn-danger {
  background-color: var(--danger-color);
  color: white;
}

.btn-danger:hover {
  background-color: #c0392b;
  transform: translateY(-2px);
}

.btn-success {
  background-color: var(--success-color);
  color: white;
}

.btn-success:hover {
  background-color: #27ae60;
  transform: translateY(-2px);
}

.btn-block {
  display: block;
  width: 100%;
}

/* Cards */

.card {
  background: var(--mui-background-paper, white);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  padding: 20px;
  margin-bottom: 20px;
  transition: var(--transition);
}

@media (prefers-color-scheme: dark) {
  .card {
    background: var(--mui-background-paper, #1e1e1e);
  }
}

.card:hover {
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.card-header {
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
  margin-bottom: 15px;
  font-size: 1.2em;
  font-weight: 600;
}

/* Form Elements */

.form-group {
  margin-bottom: 15px;
}

.form-label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
}

.form-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: var(--border-radius);
  font-size: 16px;
  transition: var(--transition);
}

.form-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

/* Status Indicators */

.status-indicator {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 8px;
}

.status-connected {
  background-color: var(--success-color);
}

.status-disconnected {
  background-color: var(--danger-color);
}

.status-pending {
  background-color: var(--warning-color);
}

/* BLE Connection Status */

.connection-status {
  display: flex;
  align-items: center;
  padding: 10px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
}

.connection-status.connected {
  background-color: rgba(46, 204, 113, 0.2);
  border: 1px solid var(--success-color);
}

.connection-status.disconnected {
  background-color: rgba(231, 76, 60, 0.2);
  border: 1px solid var(--danger-color);
}

/* Code Management */

.code-list {
  list-style: none;
}

.code-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  border-bottom: 1px solid #eee;
}

.code-item:last-child {
  border-bottom: none;
}

.code-details {
  flex: 1;
}

.code-actions {
  display: flex;
  gap: 10px;
}

/* Log Viewer */

.log-container {
  background-color: #2c3e50;
  color: #ecf0f1;
  border-radius: var(--border-radius);
  padding: 15px;
  font-family: 'Courier New', monospace;
  max-height: 400px;
  overflow-y: auto;
}

.log-entry {
  margin-bottom: 5px;
  padding: 5px 0;
  border-bottom: 1px solid #34495e;
}

.log-entry:last-child {
  border-bottom: none;
}

.log-timestamp {
  color: #95a5a6;
  margin-right: 10px;
}

.log-info {
  color: #50e3c2;
}

.log-error {
  color: #e74c3c;
}

.log-success {
  color: #2ecc71;
}

/* Responsive Design */

@media (max-width: 768px) {
  .container {
    padding: 0 10px;
  }

  .card {
    padding: 15px;
  }

  .code-item {
    flex-direction: column;
    align-items: flex-start;
  }

  .code-actions {
    margin-top: 10px;
    width: 100%;
    justify-content: flex-end;
  }
}

:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #1a73e8;
  text-decoration: inherit;
}

a:hover {
  color: #50e3c2;
}

body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a73e8;
  color: white;
  cursor: pointer;
  transition: border-color 0.25s;
}

button:hover {
  border-color: #50e3c2;
}

button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}
</style><style data-emotion="css-global" data-s="">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}</style><style data-emotion="css-global" data-s="">*,*::before,*::after{box-sizing:inherit;}</style><style data-emotion="css-global" data-s="">strong,b{font-weight:700;}</style><style data-emotion="css-global" data-s="">body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#f8f9fa;}</style><style data-emotion="css-global" data-s="">@media print{body{background-color:#fff;}}</style><style data-emotion="css-global" data-s="">body::backdrop{background-color:#f8f9fa;}</style><style data-emotion="css" data-s="">.css-zf0iqh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}</style><style data-emotion="css" data-s="">.css-16qevnj-MuiPaper-root{background-color:#ffffff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);text-align:center;padding:24px;color:#e74c3c;}</style><style data-emotion="css" data-s="">.css-dwzgvf-MuiTypography-root{margin:0;font-weight:600;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.5rem;line-height:1.334;letter-spacing:0em;}</style><style data-emotion="css" data-s="">.css-rizt0-MuiTypography-root{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style></head>
  <body>
    <div id="app"><div class="MuiBox-root css-zf0iqh"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 css-16qevnj-MuiPaper-root" style="--Paper-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);"><h1 class="MuiTypography-root MuiTypography-h5 css-dwzgvf-MuiTypography-root">Web Bluetooth Not Supported</h1><p class="MuiTypography-root MuiTypography-body1 css-rizt0-MuiTypography-root">Your browser does not support Web Bluetooth. Please use Chrome, Edge, or Bluefy on iOS.</p></div></div></div>
    <script type="module" src="/src/main.tsx"></script>


</body></html>
--- PAGE CONTENT END ---
¬∑
  1 passed (13.5s)
::notice title=üé≠ Playwright Run Summary::  1 passed (13.5s)
