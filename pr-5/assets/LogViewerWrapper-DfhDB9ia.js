import{aj as V,g as w,a as k,D as R,u as _,al as W,b as a,c as L,d as M,s as $,e as P,ak as D,R as x,be as X,i as F,t as A,l as Q,a8 as Z,ay as ee,az as te,o as T,Q as oe,q as ae,k as se,aJ as ne,bf as re,bg as le,bh as ie,a1 as O,bi as ce,bj as de,Y as pe,T as B,n as ge,C as ue,av as be,at as ye,r as he}from"./index-DaDWCM1a.js";const q=V();function me(e){return w("MuiTable",e)}k("MuiTable",["root","stickyHeader"]);const ve=e=>{const{classes:t,stickyHeader:o}=e;return M({root:["root",o&&"stickyHeader"]},me,t)},fe=$("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.stickyHeader&&t.stickyHeader]}})(P(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),E="table",J=R(function(t,o){const s=_({props:t,name:"MuiTable"}),{className:r,component:n=E,padding:l="normal",size:c="medium",stickyHeader:d=!1,...u}=s,b={...s,component:n,padding:l,size:c,stickyHeader:d},v=ve(b),g=W(()=>({padding:l,size:c,stickyHeader:d}),[l,c,d]);return a(q.Provider,{value:g,children:a(fe,{as:n,role:n===E?null:"table",ref:o,className:L(v.root,r),ownerState:b,...u})})}),z=V();function Ce(e){return w("MuiTableBody",e)}k("MuiTableBody",["root"]);const Te=e=>{const{classes:t}=e;return M({root:["root"]},Ce,t)},xe=$("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),we={variant:"body"},N="tbody",K=R(function(t,o){const s=_({props:t,name:"MuiTableBody"}),{className:r,component:n=N,...l}=s,c={...s,component:n},d=Te(c);return a(z.Provider,{value:we,children:a(xe,{className:L(d.root,r),as:n,ref:o,role:n===N?null:"rowgroup",ownerState:c,...l})})});function ke(e){return w("MuiTableCell",e)}const Re=k("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),_e=e=>{const{classes:t,variant:o,align:s,padding:r,size:n,stickyHeader:l}=e,c={root:["root",o,l&&"stickyHeader",s!=="inherit"&&`align${x(s)}`,r!=="normal"&&`padding${x(r)}`,`size${x(n)}`]};return M(c,ke,t)},Le=$("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.variant],t[`size${x(o.size)}`],o.padding!=="normal"&&t[`padding${x(o.padding)}`],o.align!=="inherit"&&t[`align${x(o.align)}`],o.stickyHeader&&t.stickyHeader]}})(P(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Re.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),m=R(function(t,o){const s=_({props:t,name:"MuiTableCell"}),{align:r="inherit",className:n,component:l,padding:c,scope:d,size:u,sortDirection:b,variant:v,...g}=s,y=D(q),f=D(z),i=f&&f.variant==="head";let p;l?p=l:p=i?"th":"td";let h=d;p==="td"?h=void 0:!h&&i&&(h="col");const C=v||f&&f.variant,H={...s,align:r,component:p,padding:c||(y&&y.padding?y.padding:"normal"),size:u||(y&&y.size?y.size:"medium"),sortDirection:b,stickyHeader:C==="head"&&y&&y.stickyHeader,variant:C},G=_e(H);let U=null;return b&&(U=b==="asc"?"ascending":"descending"),a(Le,{as:p,ref:o,className:L(G.root,n),"aria-sort":U,scope:h,ownerState:H,...g})});function Me(e){return w("MuiTableHead",e)}k("MuiTableHead",["root"]);const $e=e=>{const{classes:t}=e;return M({root:["root"]},Me,t)},He=$("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Se={variant:"head"},I="thead",De=R(function(t,o){const s=_({props:t,name:"MuiTableHead"}),{className:r,component:n=I,...l}=s,c={...s,component:n},d=$e(c);return a(z.Provider,{value:Se,children:a(He,{as:n,className:L(d.root,r),ref:o,role:n===I?null:"rowgroup",ownerState:c,...l})})});function ze(e){return w("MuiTableRow",e)}const Y=k("MuiTableRow",["root","selected","hover","head","footer"]),Be=e=>{const{classes:t,selected:o,hover:s,head:r,footer:n}=e;return M({root:["root",o&&"selected",s&&"hover",r&&"head",n&&"footer"]},ze,t)},Ae=$("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.head&&t.head,o.footer&&t.footer]}})(P(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Y.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${Y.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),j="tr",S=R(function(t,o){const s=_({props:t,name:"MuiTableRow"}),{className:r,component:n=j,hover:l=!1,selected:c=!1,...d}=s,u=D(z),b={...s,component:n,hover:l,selected:c,head:u&&u.variant==="head",footer:u&&u.variant==="footer"},v=Be(b);return a(Ae,{as:n,ref:o,className:L(v.root,r),role:n===j?null:"row",ownerState:b,...d})}),Pe=()=>{const e=D(X);if(e===void 0)throw new Error("useLogCount must be used within a DeviceProvider");return{logCount:e.logCount}};function Ue(e,t){const o=new Date(e),s=new Date,r=new Date;return r.setFullYear(s.getFullYear()-1),o<r?o.toLocaleDateString(t,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):o.toLocaleDateString(t,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}function Oe(e,t){return{code_index:t("code_index"),code_value:t("code_value"),code:t("code_value"),method:t("method"),result:t("result"),reason:t("reason"),error_code:t("error_code"),weight:t("weight"),battery_level:t("battery_level"),tagId:t("tag_id"),initiatedBy:t("initiated_by"),bootReason:t("boot_reason"),payload:t("payload")}[e]||e}const Ee=({log:e})=>{const{t,i18n:o}=F("logs"),[s,r]=A(Q(!1),"isExpanded"),n=()=>{r(!s)};return a(oe,{children:[a(S,{children:[a(m,{title:e.fullDate,children:Ue(e.timestamp,o.language)}),a(m,{children:e.event}),a(m,{children:(()=>{const l={...e.details};return delete l.age,delete l.timestamp,Object.keys(l).length>0?a(Z,{"aria-label":"expand row",size:"small",onClick:n,children:a(ee,{style:{transform:s?"rotate(180deg)":"rotate(0deg)"}})}):null})()})]}),a(S,{children:a(m,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:a(te,{in:s,timeout:"auto",unmountOnExit:!0,children:a(T,{sx:{margin:1},children:a(J,{size:"small","aria-label":"details",children:a(K,{children:(()=>{const l={...e.details};return delete l.age,delete l.timestamp,Object.entries(l).map(([c,d])=>a(S,{children:[a(m,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:Oe(c,t)}),a(m,{children:typeof d=="object"?JSON.stringify(d):String(d)})]},c))})()})})})})})})]})},Ne=({showNotification:e,hideNotification:t})=>{const{t:o,i18n:s}=F(["logs","common"]),{activeDevice:r}=ae(),{isConnected:n}=se(),{isSyncingLogs:l,requestLogs:c}=ne(),{logCount:d}=Pe(),[u,b]=A(Q([]),"parsedLogs"),v=re(()=>r?.id?(console.log(`[LogViewer] Querying logs for device_id: ${r.id}`),le.logs.where("device_id").equals(r.id).toArray().then(i=>i.sort((p,h)=>Number(h.timestamp)-Number(p.timestamp)))):[],[r?.id]),g=A(W(()=>{const i=v??ie;return console.log(`[LogViewer] raw logs count: ${i.length}`,i),i},[v]),"logs"),y=O(()=>{try{console.log(`[LogViewer] Starting parseLogsForCodeUsage with ${g.length} logs`);const i=ce(g).map(p=>{const C=new Date(p.timestamp).toLocaleString(s.language);return{...p,fullDate:C,event:o(p.description)}});console.log(`[LogViewer] Parsing finished. parsedLogs: ${i.length}`,i),b(i)}catch(i){const p=i instanceof Error?i.message:String(i);console.error(o("parse_error"),p),e&&e(o("parse_error")+": "+p,"error")}},[g,s.language,o,e]),f=O(async()=>{if(!n){e&&e(o("not_connected"),"error");return}await de(c,{showNotification:e,hideNotification:t,loadingMsg:o("refresh_started"),successMsg:o("refresh_success"),errorMsg:o("refresh_failed")})},[n,c,e,t,o]);return pe(()=>{if(g.length>0){const i=setTimeout(()=>{y()},0);return()=>clearTimeout(i)}},[g,y]),a(T,{sx:{p:2,mb:2,width:"100%"},children:[a(T,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a(B,{variant:"h5",component:"h2",children:[o("title")," ",d!==null&&d>0&&`(${d})`]}),a(ge,{variant:"outlined",startIcon:l?a(ue,{size:20}):a(be,{}),onClick:f,disabled:!n||l,children:o("refresh")})]}),!n&&!r&&g.length===0&&a(ye,{severity:"info",sx:{mb:2},children:o("connect_to_view")}),a(T,{sx:{height:"100%",width:"100%",overflowY:"auto",borderRadius:1,p:2,backgroundColor:"background.paper",fontFamily:"Courier New, monospace"},children:u.length>0?a(J,{children:[a(De,{children:a(S,{children:[a(m,{children:o("timestamp")}),a(m,{children:o("event_label")}),a(m,{})]})}),a(K,{children:u.map((i,p)=>a(Ee,{log:i},p))})]}):g.length>0?a(T,{children:g.map((i,p)=>{const h=new Date(i.timestamp),C=h.toLocaleDateString(s.language,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),H=h.toLocaleString(s.language);return a(T,{sx:{py:1,borderBottom:"1px solid",borderColor:"divider"},children:[a(B,{component:"span",fontWeight:"bold",title:H,children:C}),": ",i.event]},p)})}):a(B,{align:"center",sx:{fontStyle:"italic",py:2},component:"p",children:o(n||r?"no_logs_when_connected":"no_logs_when_disconnected")})})]})},Ye=()=>{const e=he();if(!e)return null;const{showNotification:t,hideNotification:o}=e;return a(Ne,{showNotification:t,hideNotification:o})};export{Ye as LogViewerWrapper};
