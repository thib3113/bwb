import{h as K,b as e,i as O,q as X,X as P,t as C,l as g,bp as r,Q as $,bq as z,b1 as G,af as Q,ag as Z,ah as J,ai as ee,o as v,W as R,Y as w,aT as ne,aU as te,aV as ae,aW as N,aj as oe,n as U,ae as se,br as ie,bs as W,ad as le,T as S,bt as re,aM as V,aD as de,ac as ce,ab as pe,bu as he,a4 as ue,aw as me,aX as q,aY as B,az as Y,aZ as j,r as xe}from"./index-DU_wP6JW.js";import{I as Ce,V as ge,a as fe,A as H}from"./VisibilityOff-l5ZKQjhy.js";import{D as ye}from"./Delete-BZ6Ukevt.js";import{E as be}from"./Edit-CAVOdPkW.js";const Ie=K(e("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4z"})),ve=({open:t,onClose:u,onSave:c,editingCode:a})=>{const{t:n}=O(["codes","common"]),{activeDevice:o}=X(),p=!!o?.configuration_key,m=o?.role===P.Owner||o?.role===P.Admin,[i,y]=C(g(r.MASTER),"type"),[_,x]=C(g(""),"code"),[E,T]=C(g(""),"name"),[d,b]=C(g(0),"index"),[M,A]=C(g(1),"uses"),[D,k]=C(g(!0),"showCode");$(()=>{if(t){const s=setTimeout(()=>{a?(y(a.type),x(a.code),T(a.name||a.description||""),b(a.index||0),A(a.uses||1)):(y(r.MASTER),x(z()),T(""),b(0),A(1))},0);return()=>clearTimeout(s)}},[a,t]),$(()=>{t&&o?.id&&i===r.MASTER&&G.loadCodes(o.id).then(s=>{const f=s.filter(h=>h.type===r.MASTER&&h.status!=="pending_delete").map(h=>h.index).filter(h=>h!==void 0),l=Math.max(...f,-1)+1;b(l)})},[t,o?.id,i]);const I=()=>{y(r.MASTER),x(""),T(""),b(0),A(1),k(!1),u()},L=async()=>{const s=ie(_);if(x(s),i===r.MASTER&&o?.id){const l=(await G.loadCodes(o.id)).find(h=>h.type===r.MASTER&&h.index===d&&h.status!=="pending_delete"&&(!a||h.id!==a.id));if(l){c({type:i,code:s,name:E,index:d,maxUses:M},l.id),I();return}}c({type:i,code:s,name:E,index:d,maxUses:M},a?a.id:null),I()};return e(se,{children:e(Q,{open:t,onClose:I,maxWidth:"sm",fullWidth:!0,children:[e(Z,{children:n(a?"edit_code":"add_new")}),e(J,{children:[!o?.configuration_key&&e(ee,{severity:"warning",sx:{mb:2},children:n("config_key_missing")}),e(v,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e(v,{sx:{display:"flex",gap:1},children:[e(R,{label:n("pin_label"),value:_,onChange:s=>x(s.currentTarget.value.trim().toUpperCase()),fullWidth:!0,type:D?"text":"password",slotProps:{htmlInput:{maxLength:6},input:{endAdornment:e(Ce,{position:"end",children:e(w,{"aria-label":"toggle code visibility",onClick:()=>k(!D),edge:"end",size:"small",children:D?e(ge,{}):e(fe,{})})})}}}),e(w,{onClick:()=>x(z()),"aria-label":n("generate"),children:e(Ie,{})})]}),e(R,{label:n("description_label"),value:E,onChange:s=>T(s.currentTarget.value),placeholder:n("description_placeholder"),fullWidth:!0}),e(ne,{fullWidth:!0,children:[e(te,{children:n("type_label")}),e(ae,{value:i,onChange:s=>y(s.target.value),label:n("type_label"),children:[(!m||m&&p)&&e(N,{value:r.MASTER,children:n("master_code")}),e(N,{value:r.SINGLE,children:n("single_use_code")}),e(N,{value:r.MULTI,children:n("multi_use_code")})]})]}),i===r.MASTER&&e(R,{label:`${n("index_label")}: ${d}`,type:"number",value:d,onChange:s=>b(parseInt(s.currentTarget.value)||0),fullWidth:!0,disabled:!m,slotProps:{htmlInput:{min:0,max:255}}}),i===r.MULTI&&e(R,{label:n("uses_label"),type:"number",value:M,onChange:s=>A(parseInt(s.currentTarget.value)||1),fullWidth:!0,slotProps:{htmlInput:{min:1,max:3}}})]})]}),e(oe,{children:[e(U,{onClick:I,children:n("cancel")}),e(U,{onClick:L,variant:"contained",startIcon:e(H,{}),disabled:i===r.MASTER&&(!_||_.length!==6)||i!==r.MASTER&&E.trim()==="",children:n(a?"save":"generate")})]})]})})},_e=({code:t,metadata:u,onCopy:c,onEdit:a,onDelete:n})=>{const{t:o}=O("codes"),p=t.status===W.PENDING_DELETE,m=u.used,i=p||m;return e(ce,{divider:!0,sx:{opacity:i?.6:1,backgroundColor:i?"action.selected":"inherit",textDecoration:i?"line-through":"none",borderLeft:"4px solid",borderLeftColor:t.status===W.ON_DEVICE?"primary.main":t.status===W.PENDING_ADD?"warning.main":t.status===W.PENDING_DELETE?"error.main":"default.main",pl:1},children:[e(le,{primary:e(v,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e(S,{variant:"body1",sx:{fontWeight:"bold"},children:t.name||t.description||o("unnamed")}),e(S,{variant:"caption",sx:{ml:1},children:[o("pin_label"),": ",t.code]})]}),secondary:null,slotProps:{primary:{component:"div"},secondary:{component:"div"}}}),e(re,{children:[e(V,{title:o("copy_code"),children:e(w,{edge:"end","aria-label":"copy",onClick:()=>c(t.code),children:e(de,{})})}),e(V,{title:o("edit_description"),children:e(w,{edge:"end","aria-label":"edit",onClick:()=>a(t),children:e(be,{})})}),e(w,{edge:"end","aria-label":"delete",onClick:()=>n(t.id),children:e(ye,{})})]})]})},F=({codes:t,deriveCodeMetadata:u,hasIndexConflict:c,onCopy:a,onEdit:n,onDelete:o})=>e(pe,{children:t.map(p=>e(_e,{code:p,metadata:u(p),hasIndexConflict:c?c(p.index,p.id):!1,onCopy:a,onEdit:n,onDelete:o},p.id))}),Ee=({showAddForm:t,setShowAddForm:u,showNotification:c,hideNotification:a})=>{const{t:n}=O(["codes","common"]),{activeDevice:o}=X(),[p,m]=C(g(!1),"isAddDialogOpen"),[i,y]=C(g(new Set(["permanent","temporary"])),"expandedAccordions"),[_,x]=C(g(null),"editingCode"),{masterCodes:E,temporaryCodes:T,codeCount:d,refreshCodeCount:b,hasIndexConflict:M,handleAddCode:A,handleDeleteCode:D,deriveCodeMetadata:k,getFilteredCodes:I,handleCopyCode:L}=he(c,a),s=ue(f=>{x(f),m(!0)},[]);return e(v,{sx:{width:"100%"},children:[e(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e(S,{variant:"h5",children:[n("title")," ",d&&`(Total: ${d.total})`]}),e(v,{sx:{display:"flex",gap:1},children:[e(U,{variant:"outlined",startIcon:e(me,{}),onClick:b,size:"small",children:n("refresh")}),e(w,{color:"primary",onClick:()=>m(!0),"aria-label":n("add_new"),size:"small",children:e(H,{})})]})]}),o&&e(S,{variant:"subtitle1",color:"textSecondary",sx:{mb:2},children:o.friendly_name||o.ble_name}),e(ve,{open:p||t||!1,onClose:()=>{m(!1),u&&u(!1),x(null)},onSave:A,editingCode:_}),e(q,{expanded:i.has("permanent"),onChange:()=>{y(f=>{const l=new Set(f);return l.has("permanent")?l.delete("permanent"):l.add("permanent"),l})},elevation:0,sx:{backgroundColor:"transparent",width:"100%"},disableGutters:!0,children:[e(B,{expandIcon:e(Y,{}),children:e(S,{children:[n("permanent_codes")," (",E.length,d&&` / ${d.master} ${n("codes:on_device_count")}`,")"]})}),e(j,{sx:{padding:"0 0 0 0 !important"},children:e(F,{codes:I("master"),deriveCodeMetadata:k,hasIndexConflict:M,onCopy:L,onEdit:s,onDelete:D})})]}),e(q,{expanded:i.has("temporary"),onChange:()=>{y(f=>{const l=new Set(f);return l.has("temporary")?l.delete("temporary"):l.add("temporary"),l})},elevation:0,sx:{backgroundColor:"transparent",width:"100%"},disableGutters:!0,children:[e(B,{expandIcon:e(Y,{}),children:e(S,{children:[n("temporary_codes")," (",T.length,d&&` / ${d.single} ${n("codes:on_device_count")}`,")"]})}),e(j,{sx:{padding:"0 0 0 0 !important"},children:e(F,{codes:I("temporary"),deriveCodeMetadata:k,onCopy:L,onEdit:s,onDelete:D})})]})]})},we=()=>{const t=xe();if(!t)return null;const{showNotification:u,hideNotification:c}=t;return e(v,{sx:{p:2},children:e(Ee,{showNotification:u,hideNotification:c})})};export{we as CodeManagerWrapper};
