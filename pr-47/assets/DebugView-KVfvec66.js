import{aw as A,ax as T,r as f,j as t,k as p,T as i,ay as E,M as I,aq as L,a1 as R,a2 as N,a3 as D,Y as h,D as O,ar as b,ae as g,az as S,aA as _,aB as U,ad as B,ag as P}from"./index-dyHuNd9w.js";import{D as $}from"./Delete-DikjozpS.js";import{C as V}from"./Chip-DqlWjT70.js";function F(r,n){if(!n||n.trim()==="")return"(empty)";try{const s=new Uint8Array(n.split(" ").filter(m=>m!=="").map(m=>parseInt(m,16))),l=new Uint8Array(2+s.length);l[0]=r,l[1]=s.length,l.set(s,2);const y=A(r,s,l);return y?y.toString():n}catch(s){return console.error(`Error formatting payload for opcode 0x${r.toString(16)}:`,s),n}}const G={[g]:"Battery Level (Standard)",[P]:"Battery Data (Proprietary)",[B]:"Battery Service",[U]:"Device Info Service",...Object.entries(S).reduce((r,[n,s])=>({...r,[s]:n}),{})},z=()=>{const{debugLogs:r,clearDebugLogs:n}=T(),s=f.useRef(null),[l,y]=f.useState(!1);f.useEffect(()=>{console.log(`[DebugView] Rendered with ${r.length} logs`)},[r.length]);const m=()=>{n()},v=()=>{const e=r.map(o=>({timestamp:o.timestamp.toISOString(),type:o.type,direction:o.direction,opcode:o.opcode!==void 0?`0x${o.opcode.toString(16).toUpperCase().padStart(2,"0")}`:void 0,opcodeName:o.opcode!==void 0?C(o.opcode):void 0,payload:o.payload,raw:o.raw})),a=JSON.stringify(e);navigator.clipboard.writeText(a),y(!0)},C=e=>e===0?"UNPARSABLE / RAW":e===h.INTERNAL_GATT_OPERATION?"GATT READ":_[e]||`UNKNOWN (0x${e.toString(16).toUpperCase().padStart(2,"0")})`,w=e=>{if(e.opcode===h.INTERNAL_GATT_OPERATION){const a=e.uuid,o=a?Object.entries(G).find(([c])=>c.toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(c.toLowerCase()))?.[1]:null;if(e.direction==="TX")return`READ: ${o||a||"Unknown"}`;if(a&&typeof e.payload=="string"){const c=e.payload.replace(/ /g,""),x=a.toLowerCase();if(x.includes(g.toLowerCase())||g.toLowerCase().includes(x))return`${parseInt(c,16)}% (${o||"Battery"})`;if(Object.values(S).some(d=>x.includes(d.toLowerCase())||d.toLowerCase().includes(x)))try{let d="";for(let u=0;u<c.length;u+=2){const j=parseInt(c.substr(u,2),16);j!==0&&(d+=String.fromCharCode(j))}return`"${d}" (${o})`}catch{}}return`${e.payload} ${o?`(${o})`:""}`}return F(e.opcode,e.payload||"")};return t.jsxs(p,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(p,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[t.jsx(i,{variant:"h6",children:"BLE Activity Logger"}),t.jsxs(p,{children:[t.jsx(E,{title:"Copier JSON",children:t.jsx(I,{onClick:v,children:t.jsx(L,{})})}),t.jsx(E,{title:"Effacer",children:t.jsx(I,{onClick:m,children:t.jsx($,{})})})]})]}),t.jsxs(R,{sx:{flexGrow:1,overflow:"auto",p:0},ref:s,children:[r.length===0&&t.jsx(p,{sx:{p:3,textAlign:"center",color:"text.secondary"},children:"No activity captured yet"}),r.map(e=>t.jsxs("div",{children:[t.jsx(N,{alignItems:"flex-start",sx:{py:1},children:t.jsx(D,{primary:t.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(V,{label:e.type==="packet"?e.direction:e.type.toUpperCase(),size:"small",color:e.type==="error"?"error":e.type==="system"?"info":e.direction==="TX"?"primary":"secondary",variant:e.type==="packet"?"outlined":"filled"}),t.jsxs(i,{variant:"subtitle2",component:"span",sx:{fontFamily:"monospace"},children:[e.timestamp.toLocaleTimeString(),".",e.timestamp.getMilliseconds().toString().padStart(3,"0")]}),e.type==="packet"&&t.jsx(i,{variant:"subtitle2",component:"span",sx:{fontWeight:"bold"},children:C(e.opcode)})]}),secondary:t.jsx(p,{sx:{mt:.5,fontFamily:"monospace",fontSize:"0.85rem",wordBreak:"break-all"},children:e.type==="packet"?t.jsxs(t.Fragment,{children:[e.opcode!==h.INTERNAL_GATT_OPERATION&&t.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",children:["Opcode: 0x",e.opcode.toString(16).padStart(2,"0").toUpperCase()]}),t.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",children:["Payload: ",w(e)]}),t.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:["Raw: ",e.raw||"(empty)"]})]}):t.jsx(i,{variant:"body2",color:"text.primary",children:e.raw})}),slotProps:{primary:{component:"div"},secondary:{component:"div"}}})}),t.jsx(O,{component:"li"})]},e.id))]}),t.jsx(b,{open:l,autoHideDuration:3e3,onClose:()=>y(!1),message:"Logs copi√©s au format JSON"})]})};export{z as DebugView};
