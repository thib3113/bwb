import{h as z,b as e,i as N,t as u,l as f,a3 as k,aY as M,aZ as R,a_ as V,a$ as $,o as d,a2 as F,T as m,ac as K,b0 as W,b1 as U,az as Z,b2 as J,ab as H,W as j,ai as I,n as C,Y as P,a0 as X,an as E,b3 as A,b4 as q,P as Q,a6 as Y,w as G,b5 as ee,Q as te,H as O,F as T,Z as ae,$ as re,b6 as L}from"./index-DhBpWozg.js";import{S as ne}from"./Stack-DeXO_L-X.js";import{E as le}from"./Edit-D58qsniH.js";import{D as se}from"./Delete-D9QVg575.js";import{T as oe,a as B}from"./Tabs-ts0_IRsC.js";import{C as ie}from"./Container-CdWITiuB.js";const ce=z(e("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),de=z(e("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"})),he=({tableName:t,item:n,primaryKey:l})=>{const[i,s]=u(f(!1),"isEditing"),[r,c]=u(f(JSON.stringify(n,null,2)),"editValue"),[h,x]=u(f(null),"error"),o=async()=>{try{const p=JSON.parse(r);await k.table(t).put(p),s(!1),x(null)}catch(p){x(p instanceof Error?p.message:"Invalid JSON")}},v=async()=>{confirm("Are you sure you want to delete this record?")&&await k.table(t).delete(l)};return i?e(d,{sx:{p:1},children:[e(j,{fullWidth:!0,multiline:!0,minRows:3,value:r,onChange:p=>c(p.target.value),variant:"outlined",size:"small",sx:{fontFamily:"monospace",mb:1}}),h&&e(I,{severity:"error",sx:{mb:1},children:h}),e(ne,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e(C,{startIcon:e(ce,{}),onClick:()=>{s(!1),c(JSON.stringify(n,null,2)),x(null)},size:"small",children:"Cancel"}),e(C,{startIcon:e(de,{}),onClick:o,variant:"contained",size:"small",children:"Save"})]})]}):e(d,{children:[e(d,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:[e(P,{size:"small",onClick:()=>s(!0),children:e(le,{fontSize:"small"})}),e(P,{size:"small",onClick:v,color:"error",children:e(se,{fontSize:"small"})})]}),e(d,{component:"pre",sx:{overflowX:"auto",fontSize:"0.75rem",m:0,p:1,bgcolor:"action.hover",borderRadius:1},children:JSON.stringify(n,null,2)})]})},ue=({tableName:t})=>{const{t:n}=N(["settings"]),l=F(()=>k.table(t).toArray(),[t]),s=k.table(t).schema.primKey.name;return l?l.length===0?e(m,{children:n("settings:developer.no_records")}):e(H,{children:l.map((r,c)=>{const h=r[s];return e(K,{disablePadding:!0,children:e(W,{sx:{width:"100%"},children:[e(U,{expandIcon:e(Z,{}),children:e(m,{noWrap:!0,children:r.id||r.name||r.key||`Record ${c}`})}),e(J,{children:e(he,{tableName:t,item:r,primaryKey:h})})]})},h||c)})}):e(m,{children:n("settings:developer.loading")})},me=()=>{const{t}=N(["settings"]),[n,l]=u(f(""),"selectedTable"),i=k.tables.map(r=>r.name),s=r=>{l(r.target.value)};return e(d,{sx:{mt:2},children:[e(M,{fullWidth:!0,size:"small",sx:{mb:2},children:[e(R,{children:t("settings:developer.select_table")}),e(V,{value:n,label:t("settings:developer.select_table"),onChange:s,children:i.map(r=>e($,{value:r,children:r},r))})]}),n&&e(ue,{tableName:n})]})},pe=t=>Y[t]||`UNKNOWN_OPCODE_${t}`,ge=()=>{const{sendPacket:t,isConnected:n}=X(),[l,i]=u(f(""),"selectedOpcode"),[s,r]=u(f({}),"formData"),[c,h]=u(f(null),"validationError"),x=u(E(()=>Array.from(A.getRegisteredTXPackets().entries()).sort((a,g)=>a[0]-g[0]),[]),"registeredPackets"),o=u(E(()=>l===""?null:A.getRegisteredTXPackets().get(l),[l]),"SelectedPacketClass"),v=u(E(()=>!o||!o.schema?null:o.schema instanceof q?o.schema.shape:null,[o]),"schemaShape"),p=a=>{i(a.target.value),r({}),h(null)},y=(a,g)=>{r(b=>({...b,[a]:g})),h(null)},S=async()=>{if(o)try{let a={};if(o.schema){const b=o.schema.safeParse(s);if(!b.success){const _=b.error.errors.map(D=>`${D.path.join(".")}: ${D.message}`).join(", ");h(_);return}a=b.data}const g=new o;Object.assign(g,a),await t(g),console.log("Packet sent successfully",g)}catch(a){console.error("Failed to send packet",a),h(a.message||"Unknown error")}};return e(d,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e(I,{severity:n?"success":"warning",children:n?"Connected to device":"Not connected (Packets will be queued or fail)"}),e(M,{fullWidth:!0,children:[e(R,{children:"Select Packet Type"}),e(V,{value:l,label:"Select Packet Type",onChange:p,children:x.map(([a])=>e($,{value:a,children:[pe(a)," (",a,")"]},a))})]}),o&&e(Q,{variant:"outlined",sx:{p:2},children:[e(m,{variant:"h6",gutterBottom:!0,children:"Packet Parameters"}),e(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[v?Object.keys(v).length>0?Object.keys(v).map(a=>{const g=v[a];let b=!1,_=g._def.typeName;return(_==="ZodNumber"||_==="ZodEffects"&&g._def.schema?._def.typeName==="ZodNumber")&&(b=!0),e(j,{label:a,variant:"outlined",fullWidth:!0,type:b?"number":"text",value:s[a]||"",onChange:D=>y(a,D.target.value),helperText:b?"Number":"String"},a)}):e(m,{color:"text.secondary",children:"No parameters required for this packet."}):e(m,{color:"text.secondary",children:"No schema defined for this packet."}),c&&e(I,{severity:"error",children:c}),e(C,{variant:"contained",onClick:S,disabled:!n&&!window.BOKS_SIMULATOR_ENABLED,children:"Send Packet"})]})]})]})};function w(t){const{children:n,value:l,index:i,...s}=t;return e("div",{role:"tabpanel",hidden:l!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...s,children:l===i&&e(d,{sx:{p:2},children:n})})}const Ce=()=>{const{t}=N(["settings"]),n=G(),{isDeveloperMode:l,disableDeveloperMode:i}=ee(),[s,r]=u(f(!1),"simulatorEnabled"),[c,h]=u(f(0),"tabValue");te(()=>{l||n("/");const y=localStorage.getItem("BOKS_SIMULATOR_ENABLED")==="true";r(y)},[l,n]);const x=()=>{i(),n("/")},o=y=>{const S=y.target.checked;r(S),S?localStorage.setItem("BOKS_SIMULATOR_ENABLED","true"):localStorage.removeItem("BOKS_SIMULATOR_ENABLED"),window.location.reload()},v=async()=>{try{confirm(t("settings:developer.mock_data_confirm"))&&(await L.mockData(),alert(t("settings:developer.mock_data_success")))}catch(y){console.error(y),alert(t("settings:developer.mock_data_failed"))}},p=(y,S)=>{h(S)};return e(ie,{maxWidth:"md",sx:{py:2},children:[e(d,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(m,{variant:"h4",children:t("settings:developer.page_title")}),e(C,{variant:"outlined",color:"error",onClick:x,children:t("settings:developer.disable_mode")})]}),e(d,{sx:{borderBottom:1,borderColor:"divider"},children:e(oe,{value:c,onChange:p,"aria-label":"developer tabs",children:[e(B,{label:"General"}),e(B,{label:"Database"}),e(B,{label:"Bluetooth"})]})}),e(w,{value:c,index:0,children:e(O,{sx:{mb:3},children:e(T,{children:e(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(m,{variant:"h6",children:t("settings:developer.simulators_tools")}),e(ae,{control:e(re,{checked:s,onChange:o}),label:t("settings:developer.enable_simulator")}),e(d,{children:[e(d,{sx:{display:"flex",gap:2},children:[e(C,{variant:"contained",onClick:v,children:t("settings:developer.load_mock_data")}),e(C,{variant:"outlined",color:"error",onClick:()=>{confirm(t("settings:developer.clear_db_confirm"))&&L.clearAllData()},children:t("settings:developer.clear_db")})]}),e(m,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:t("settings:developer.mock_data_helper")})]})]})})})}),e(w,{value:c,index:1,children:e(O,{children:e(T,{children:[e(m,{variant:"h6",gutterBottom:!0,children:t("settings:developer.db_editor")}),e(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:t("settings:developer.db_editor_helper")}),e(me,{})]})})}),e(w,{value:c,index:2,children:e(O,{children:e(T,{children:[e(m,{variant:"h6",gutterBottom:!0,children:"Bluetooth Debugger"}),e(ge,{})]})})})]})};export{Ce as DeveloperPage};
