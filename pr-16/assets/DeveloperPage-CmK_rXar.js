import{h as $,b as e,i as D,t as u,l as v,a3 as k,aX as R,aY as j,aZ as V,a_ as W,o as i,a2 as Y,T as h,ac as Q,a$ as G,b0 as q,az as ee,b1 as te,ab as ae,W as F,ai as w,n as S,Y as P,a0 as K,P as H,aO as re,an as E,b2 as A,b3 as ne,a6 as se,w as le,b4 as oe,Q as ie,H as B,F as I,Z as ce,$ as de,b5 as M}from"./index-Bp4QzDbV.js";import{S as he}from"./Stack-DgEnRjuh.js";import{E as ue}from"./Edit-CAbhZbKf.js";import{D as U}from"./Delete-fsqgT7p8.js";import{T as me,a as pe,b as N,c as x,d as ge}from"./TableRow-BF6n43oh.js";import{C as be}from"./Chip-Cu0OERvy.js";import{T as ve,a as L}from"./Tabs-Ju1iwmsR.js";import{C as fe}from"./Container-B_rtR_oT.js";const ye=$(e("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),xe=$(e("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"})),_e=({tableName:t,item:n,primaryKey:s})=>{const[l,c]=u(v(!1),"isEditing"),[a,d]=u(v(JSON.stringify(n,null,2)),"editValue"),[p,m]=u(v(null),"error"),C=async()=>{try{const g=JSON.parse(a);await k.table(t).put(g),c(!1),m(null)}catch(g){m(g instanceof Error?g.message:"Invalid JSON")}},_=async()=>{confirm("Are you sure you want to delete this record?")&&await k.table(t).delete(s)};return l?e(i,{sx:{p:1},children:[e(F,{fullWidth:!0,multiline:!0,minRows:3,value:a,onChange:g=>d(g.target.value),variant:"outlined",size:"small",sx:{fontFamily:"monospace",mb:1}}),p&&e(w,{severity:"error",sx:{mb:1},children:p}),e(he,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e(S,{startIcon:e(ye,{}),onClick:()=>{c(!1),d(JSON.stringify(n,null,2)),m(null)},size:"small",children:"Cancel"}),e(S,{startIcon:e(xe,{}),onClick:C,variant:"contained",size:"small",children:"Save"})]})]}):e(i,{children:[e(i,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:[e(P,{size:"small",onClick:()=>c(!0),children:e(ue,{fontSize:"small"})}),e(P,{size:"small",onClick:_,color:"error",children:e(U,{fontSize:"small"})})]}),e(i,{component:"pre",sx:{overflowX:"auto",fontSize:"0.75rem",m:0,p:1,bgcolor:"action.hover",borderRadius:1},children:JSON.stringify(n,null,2)})]})},Se=({tableName:t})=>{const{t:n}=D(["settings"]),s=Y(()=>k.table(t).toArray(),[t]),c=k.table(t).schema.primKey.name;return s?s.length===0?e(h,{children:n("settings:developer.no_records")}):e(ae,{children:s.map((a,d)=>{const p=a[c];return e(Q,{disablePadding:!0,children:e(G,{sx:{width:"100%"},children:[e(q,{expandIcon:e(ee,{}),children:e(h,{noWrap:!0,children:a.id||a.name||a.key||`Record ${d}`})}),e(te,{children:e(_e,{tableName:t,item:a,primaryKey:p})})]})},p||d)})}):e(h,{children:n("settings:developer.loading")})},Ce=()=>{const{t}=D(["settings"]),[n,s]=u(v(""),"selectedTable"),l=k.tables.map(a=>a.name),c=a=>{s(a.target.value)};return e(i,{sx:{mt:2},children:[e(R,{fullWidth:!0,size:"small",sx:{mb:2},children:[e(j,{children:t("settings:developer.select_table")}),e(V,{value:n,label:t("settings:developer.select_table"),onChange:c,children:l.map(a=>e(W,{value:a,children:a},a))})]}),n&&e(Se,{tableName:n})]})},ke=()=>{const{t}=D(["settings"]),{debugLogs:n,clearDebugLogs:s}=K(),l=n.filter(a=>a.type==="packet").sort((a,d)=>new Date(d.timestamp).getTime()-new Date(a.timestamp).getTime()),c=a=>a===void 0?"UNKNOWN":re[a]||`OP_${a.toString(16).toUpperCase()}`;return e(i,{sx:{mt:4},children:[e(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e(h,{variant:"h6",children:t("settings:developer.packet_logger_title")}),e(S,{variant:"outlined",color:"error",startIcon:e(U,{}),onClick:s,size:"small",children:t("settings:developer.clear_logs")})]}),e(H,{variant:"outlined",sx:{width:"100%",overflow:"hidden"},children:e(i,{sx:{maxHeight:400,overflowY:"auto"},children:e(me,{stickyHeader:!0,size:"small",children:[e(pe,{children:e(N,{children:[e(x,{children:"Time"}),e(x,{children:"Dir"}),e(x,{children:"Opcode"}),e(x,{children:"Payload (Hex)"})]})}),e(ge,{children:l.length>0?l.map(a=>e(N,{hover:!0,children:[e(x,{sx:{whiteSpace:"nowrap",fontSize:"0.75rem"},children:new Date(a.timestamp).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}),e(x,{children:e(be,{label:a.direction,color:a.direction==="TX"?"primary":"success",size:"small",sx:{fontSize:"0.7rem",height:20}})}),e(x,{sx:{fontSize:"0.75rem",fontWeight:"bold"},children:c(a.opcode)}),e(x,{sx:{fontFamily:"monospace",fontSize:"0.75rem",wordBreak:"break-all"},children:a.payload||"-"})]},a.id)):e(N,{children:e(x,{colSpan:4,align:"center",children:e(h,{variant:"body2",color:"text.secondary",sx:{py:2},children:t("settings:developer.no_records")})})})})]})})})]})},De=t=>se[t]||`UNKNOWN_OPCODE_${t}`,Te=()=>{const{t}=D(["settings"]),{sendPacket:n,isConnected:s}=K(),[l,c]=u(v(""),"selectedOpcode"),[a,d]=u(v({}),"formData"),[p,m]=u(v(null),"validationError"),[C,_]=u(v(null),"successMessage"),g=u(E(()=>Array.from(A.getRegisteredTXPackets().entries()).sort((r,b)=>r[0]-b[0]),[]),"registeredPackets"),o=u(E(()=>l===""?null:A.getRegisteredTXPackets().get(l),[l]),"SelectedPacketClass"),f=u(E(()=>!o||!o.schema?null:o.schema instanceof ne?o.schema.shape:null,[o]),"schemaShape"),Z=r=>{c(r.target.value),d({}),m(null),_(null)},J=(r,b)=>{d(y=>({...y,[r]:b})),m(null),_(null)},X=async()=>{if(o){m(null),_(null);try{let r={};if(o.schema){const y=o.schema.safeParse(a);if(!y.success){const T=y.error.errors.map(O=>`${O.path.join(".")}: ${O.message}`).join(", ");m(T);return}r=y.data}const b=new o;Object.assign(b,r),await n(b),console.log("Packet sent successfully",b),_(t("settings:developer.packet_sent_success"))}catch(r){console.error("Failed to send packet",r),m(r.message||t("settings:developer.packet_send_error"))}}};return e(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e(w,{severity:s?"success":"warning",children:t(s?"settings:developer.enabled_success":"settings:developer.not_connected_warning")}),e(R,{fullWidth:!0,children:[e(j,{children:t("settings:developer.packet_type_label")}),e(V,{value:l,label:t("settings:developer.packet_type_label"),onChange:Z,children:g.map(([r])=>e(W,{value:r,children:[De(r)," (",r,")"]},r))})]}),o&&e(H,{variant:"outlined",sx:{p:2},children:[e(h,{variant:"h6",gutterBottom:!0,children:t("settings:developer.packet_parameters_title")}),e(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[f?Object.keys(f).length>0?Object.keys(f).map(r=>{const b=f[r];let y=!1,T=b._def.typeName;return(T==="ZodNumber"||T==="ZodEffects"&&b._def.schema?._def.typeName==="ZodNumber")&&(y=!0),e(F,{label:r,variant:"outlined",fullWidth:!0,type:y?"number":"text",value:a[r]||"",onChange:O=>J(r,O.target.value),helperText:y?"Number":"String"},r)}):e(h,{color:"text.secondary",children:t("settings:developer.no_parameters")}):e(h,{color:"text.secondary",children:t("settings:developer.no_schema")}),p&&e(w,{severity:"error",children:p}),C&&e(w,{severity:"success",children:C}),e(S,{variant:"contained",onClick:X,disabled:!s&&!window.BOKS_SIMULATOR_ENABLED,children:t("settings:developer.send_packet")})]})]}),e(ke,{})]})};function z(t){const{children:n,value:s,index:l,...c}=t;return e("div",{role:"tabpanel",hidden:s!==l,id:`simple-tabpanel-${l}`,"aria-labelledby":`simple-tab-${l}`,...c,children:s===l&&e(i,{sx:{p:2},children:n})})}const Pe=()=>{const{t}=D(["settings"]),n=le(),{isDeveloperMode:s,disableDeveloperMode:l}=oe(),[c,a]=u(v(!1),"simulatorEnabled"),[d,p]=u(v(0),"tabValue");ie(()=>{s||n("/");const o=localStorage.getItem("BOKS_SIMULATOR_ENABLED")==="true";a(o)},[s,n]);const m=()=>{l(),n("/")},C=o=>{const f=o.target.checked;a(f),f?localStorage.setItem("BOKS_SIMULATOR_ENABLED","true"):localStorage.removeItem("BOKS_SIMULATOR_ENABLED"),window.location.reload()},_=async()=>{try{confirm(t("settings:developer.mock_data_confirm"))&&(await M.mockData(),alert(t("settings:developer.mock_data_success")))}catch(o){console.error(o),alert(t("settings:developer.mock_data_failed"))}},g=(o,f)=>{p(f)};return e(fe,{maxWidth:"md",sx:{py:2},children:[e(i,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(h,{variant:"h4",children:t("settings:developer.page_title")}),e(S,{variant:"outlined",color:"error",onClick:m,children:t("settings:developer.disable_mode")})]}),e(i,{sx:{borderBottom:1,borderColor:"divider"},children:e(ve,{value:d,onChange:g,"aria-label":"developer tabs",children:[e(L,{label:"General"}),e(L,{label:"Database"}),e(L,{label:"Bluetooth"})]})}),e(z,{value:d,index:0,children:e(B,{sx:{mb:3},children:e(I,{children:e(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(h,{variant:"h6",children:t("settings:developer.simulators_tools")}),e(ce,{control:e(de,{checked:c,onChange:C}),label:t("settings:developer.enable_simulator")}),e(i,{children:[e(i,{sx:{display:"flex",gap:2},children:[e(S,{variant:"contained",onClick:_,children:t("settings:developer.load_mock_data")}),e(S,{variant:"outlined",color:"error",onClick:()=>{confirm(t("settings:developer.clear_db_confirm"))&&M.clearAllData()},children:t("settings:developer.clear_db")})]}),e(h,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:t("settings:developer.mock_data_helper")})]})]})})})}),e(z,{value:d,index:1,children:e(B,{children:e(I,{children:[e(h,{variant:"h6",gutterBottom:!0,children:t("settings:developer.db_editor")}),e(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:t("settings:developer.db_editor_helper")}),e(Ce,{})]})})}),e(z,{value:d,index:2,children:e(B,{children:e(I,{children:[e(h,{variant:"h6",gutterBottom:!0,children:"Bluetooth Debugger"}),e(Te,{})]})})})]})};export{Pe as DeveloperPage};
