import{aN as x,aO as L,t as S,U as N,l as R,Y as b,b as t,o as p,T as s,aP as E,a8 as v,aF as O,a9 as D,aa as _,ab as U,Q as B,aQ as h,I as P,aG as $,as as C,aR as T,aS as V,aT as G,ar as j,au as F}from"./index-_kBGGSqF.js";import{D as Y}from"./Delete-BwYo5SLD.js";import{C as J}from"./Chip-EUySROpI.js";function W(r,a){if(!a||a.trim()==="")return"(empty)";try{const n=new Uint8Array(a.split(" ").filter(m=>m!=="").map(m=>parseInt(m,16))),l=new Uint8Array(2+n.length);l[0]=r,l[1]=n.length,l.set(n,2);const y=x(r,n,l);return y?y.toString():a}catch(n){return console.error(`Error formatting payload for opcode 0x${r.toString(16)}:`,n),a}}const M={[C]:"Battery Level (Standard)",[F]:"Battery Data (Proprietary)",[j]:"Battery Service",[G]:"Device Info Service",...Object.entries(T).reduce((r,[a,n])=>({...r,[n]:a}),{})},q=()=>{const{debugLogs:r,clearDebugLogs:a}=L(),n=S(N(null),"listRef"),[l,y]=S(R(!1),"copySuccess");b(()=>{console.log(`[DebugView] Rendered with ${r.length} logs`)},[r.length]);const m=()=>{a()},A=()=>{const e=r.map(o=>({timestamp:o.timestamp.toISOString(),type:o.type,direction:o.direction,opcode:o.opcode!==void 0?`0x${o.opcode.toString(16).toUpperCase().padStart(2,"0")}`:void 0,opcodeName:o.opcode!==void 0?g(o.opcode):void 0,payload:o.payload,raw:o.raw})),i=JSON.stringify(e);navigator.clipboard.writeText(i),y(!0)},g=e=>e===0?"UNPARSABLE / RAW":e===h.INTERNAL_GATT_OPERATION?"GATT READ":V[e]||`UNKNOWN (0x${e.toString(16).toUpperCase().padStart(2,"0")})`,w=e=>{if(e.opcode===h.INTERNAL_GATT_OPERATION){const i=e.uuid,o=i?Object.entries(M).find(([c])=>c.toLowerCase().includes(i.toLowerCase())||i.toLowerCase().includes(c.toLowerCase()))?.[1]:null;if(e.direction==="TX")return`READ: ${o||i||"Unknown"}`;if(i&&typeof e.payload=="string"){const c=e.payload.replace(/ /g,""),u=i.toLowerCase();if(u.includes(C.toLowerCase())||C.toLowerCase().includes(u))return`${parseInt(c,16)}% (${o||"Battery"})`;if(Object.values(T).some(d=>u.includes(d.toLowerCase())||d.toLowerCase().includes(u)))try{let d="";for(let f=0;f<c.length;f+=2){const I=parseInt(c.substr(f,2),16);I!==0&&(d+=String.fromCharCode(I))}return`"${d}" (${o})`}catch{}}return`${e.payload} ${o?`(${o})`:""}`}return W(e.opcode,e.payload)};return t(p,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t(p,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[t(s,{variant:"h6",children:"BLE Activity Logger"}),t(p,{children:[t(E,{title:"Copier JSON",children:t(v,{onClick:A,children:t(O,{})})}),t(E,{title:"Effacer",children:t(v,{onClick:m,children:t(Y,{})})})]})]}),t(D,{sx:{flexGrow:1,overflow:"auto",p:0},ref:n,children:[r.length===0&&t(p,{sx:{p:3,textAlign:"center",color:"text.secondary"},children:"No activity captured yet"}),r.map(e=>t("div",{children:[t(_,{alignItems:"flex-start",sx:{py:1},children:t(U,{primary:t(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[t(J,{label:e.type==="packet"?e.direction:e.type.toUpperCase(),size:"small",color:e.type==="error"?"error":e.type==="system"?"info":e.direction==="TX"?"primary":"secondary",variant:e.type==="packet"?"outlined":"filled"}),t(s,{variant:"subtitle2",component:"span",sx:{fontFamily:"monospace"},children:[e.timestamp.toLocaleTimeString(),".",e.timestamp.getMilliseconds().toString().padStart(3,"0")]}),e.type==="packet"&&t(s,{variant:"subtitle2",component:"span",sx:{fontWeight:"bold"},children:g(e.opcode)})]}),secondary:t(p,{sx:{mt:.5,fontFamily:"monospace",fontSize:"0.85rem",wordBreak:"break-all"},children:e.type==="packet"?t(B,{children:[e.opcode!==h.INTERNAL_GATT_OPERATION&&t(s,{variant:"caption",display:"block",color:"text.secondary",children:["Opcode: 0x",e.opcode.toString(16).padStart(2,"0").toUpperCase()]}),t(s,{variant:"caption",display:"block",color:"text.secondary",children:["Payload: ",w(e)]}),t(s,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:["Raw: ",e.raw||"(empty)"]})]}):t(s,{variant:"body2",color:"text.primary",children:e.raw})}),slotProps:{primary:{component:"div"},secondary:{component:"div"}}})}),t(P,{component:"li"})]},e.id))]}),t($,{open:l,autoHideDuration:3e3,onClose:()=>y(!1),message:"Logs copi√©s au format JSON"})]})};export{q as DebugView};
